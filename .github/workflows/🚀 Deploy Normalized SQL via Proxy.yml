name: üöÄ Deploy Normalized SQL via Proxy

on:
  workflow_dispatch:

env:
  PROJECT_REF: ${{ secrets.PROJECT_REF }}
  SQL_PROXY_URL: ${{ secrets.SQL_PROXY_URL }}
  SQL_PROXY_SECRET: ${{ secrets.SQL_PROXY_SECRET }}
  SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}

jobs:
  deploy-sql:
    runs-on: ubuntu-latest
    name: Deploy SQL Scripts via Proxy

    steps:
      - name: ‚¨áÔ∏è Checkout Repo
        uses: actions/checkout@v3

      - name: üîë Make deploy script executable
        run: chmod +x ./deploy_all_sql_via_proxy.sh

      - name: üöÄ Run deploy script
        run: ./deploy_all_sql_via_proxy.sh
        env:
          PROJECT_REF: ${{ secrets.PROJECT_REF }}
          SQL_PROXY_URL: ${{ secrets.SQL_PROXY_URL }}
          SQL_PROXY_SECRET: ${{ secrets.SQL_PROXY_SECRET }}
          SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
